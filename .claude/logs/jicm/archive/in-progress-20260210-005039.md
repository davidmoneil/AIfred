# JICM In-Progress State — B.4 Feature Requests (5/6 done)

## Status: Task #6 (status line accuracy) IN PROGRESS, compression agent running

## Completed This Session
1. **tmux window titles** — DONE: `-n "Jarvis"`, `-n "Watcher"`, `automatic-rename off` in launch-jarvis-tmux.sh
2. **/export before compress/clear** — DONE: watcher v5.8.4, `export_chat_history()` two-layer (tmux capture + /export), section 3 + section 1.5
3. **Memory mirror hook** — DONE: `memory-mirror.js` PostToolUse ^Write$, symlinks for 3 external scripts + 1 hook
4. **Tool output offloading** — DOCUMENTED in compaction-essentials.md, `.tool-output/` dir created
5. **~/.claude/ data concerns** — ADDRESSED: symlinks, todos all empty, history.jsonl useful

## Task #6 In Progress: Status Line Accuracy
- **Root cause**: Hardcoded overhead 25,800 tokens in both jarvis-statusline.sh and update-context-cache.js
- **Evidence**: API says 55% (110K) but cache calculated 43K total — 67K discrepancy
- **Planned fixes**: Move constants to .jicm-config, extend cache validity 10→30min, add consistency check

## Files Created
- `.claude/hooks/memory-mirror.js`, `.claude/exports/`, `.claude/context/memory/MEMORY.md`, `.claude/context/.tool-output/`
- Symlinks: jarvis-statusline.sh, update-context-cache.sh, statusline-debug-capture.sh, update-context-cache.js

## Files Modified
- `.claude/scripts/launch-jarvis-tmux.sh` (window naming)
- `.claude/scripts/jarvis-watcher.sh` (v5.8.4: export, 6 version strings)
- `.claude/agents/compression-agent.md` (chat export as Priority 3 source)
- `.claude/settings.json` (memory-mirror hook)
- `.claude/context/compaction-essentials.md` (offloading docs, hooks 26)
- `.gitignore` (exports, tool-output, memory, symlinks)

## Decisions
1. Two-layer export: tmux capture-pane (instant failsafe) + /export (richer format)
2. Memory mirror via hook (not symlink) — Write triggers copy, source of truth stays in ~/.claude/
3. Tool output offloading documented but deferred — design only for now
4. Symlinks for external scripts (don't move — would break statusline references)

## Next Steps
1. Complete Task #6 status line fixes
2. Commit all B.4 enhancement work
3. B.7 AC-10 Ulfhedthnar or user-directed

## Counts: Hooks 26 (21 .js + 5 .sh) | Patterns 51 | Skills 28 | Agents 13
