# JICM In-Progress State Dump

## Session: 2026-02-10 (Phase F.1 Ennoia MVP Implementation)

### Current Task
**Phase F.1 Ennoia MVP** — upgrading ennoia.sh v0.1 → v0.2 with .ennoia-recommendation signal file handoff to Watcher.

### Plan File
`/Users/aircannon/Claude/Jarvis/.claude/plans/greedy-hatching-stroustrup.md` — 8-step implementation plan, approved.

### Completed This Session
1. **Task #1 DONE: ennoia.sh v0.1 → v0.2** (Steps 1-3)
   - Added `get_current_work()` — extracts Status from session-state.md, strips markdown/emoji, truncates 80 chars
   - Added `get_next_priority()` — extracts **Next**: or first ### under ## Up Next from priorities, truncates 60 chars
   - Added `write_recommendation()` — writes `.ennoia-recommendation` atomically (tmp→mv):
     - arise: `[SESSION-START] New session. Current: {work}. Next: {priority}. Read session-state.md...`
     - resume: `[JICM-RESUME] Context compressed and cleared. Read .compressed-context-ready.md...`
     - attend/idle: no recommendation (Phase J scope)
   - Wired `write_recommendation "$mode"` into `render()` after case block
   - Updated `.ennoia-status` to include `version: 0.2` and `recommendation_active: true/false`
   - Added `REC: ready` indicator to dashboard footer
   - Updated header comment to v0.2
   - **Syntax check PASSED** (`bash -n`)
   - File: `/Users/aircannon/Claude/Jarvis/.claude/scripts/ennoia.sh` (194→280 lines)

### Files Modified
- `.claude/scripts/ennoia.sh` — v0.1 → v0.2 (DONE, +86 lines)

### Remaining Tasks (from plan)
2. **Task #2: jarvis-watcher.sh** (Steps 4-5, 8) — Add `ENNOIA_RECOMMENDATION` path constant, `read_ennoia_recommendation()` helper (~35 lines), modify `send_prompt_by_type()` RESUME variant to check Ennoia first. Bump version v5.8.4 → v5.8.5.
3. **Task #3: launch-jarvis-tmux.sh** (Step 6) — Add Window 2 "Ennoia" after line 154, update automatic-rename, window listing, keyboard shortcuts.
4. **Task #4: capability-map.yaml** (Step 7) — Add `aion.ennoia` entry after line 261 (after ac.10-ulfhedthnar).
5. **Task #5: Verification** (V1-V7) — Standalone test, atomic write, Watcher integration, degradation, staleness, full JICM cycle, tmux launcher.

### Key Decisions
1. Only RESUME variant checks Ennoia — SIMPLE/MINIMAL (retries) stay hardcoded for reliability
2. Emergency paths (`handle_critical_state`) unaffected — they bypass `send_prompt_by_type()`
3. 120-second staleness threshold — stale recommendations deleted, Watcher falls back
4. Format validation: recommendation must start with `[` prefix (prevents garbage injection)
5. Single-use consumption: Watcher deletes file after reading, Ennoia rewrites on next 30s cycle

### Watcher Modification Details (for Task #2)
- `read_ennoia_recommendation()` at ~line 945: check existence → staleness → format → read+consume → return text or empty
- `send_prompt_by_type()` at line 1107: add RESUME guard before case statement, call read_ennoia_recommendation(), use if non-empty, else fall through

### Blockers
None — straightforward implementation remaining.

### Next Steps
1. Implement Task #2 (Watcher modification) — highest priority, core integration
2. Task #3 (launcher) and Task #4 (capability-map) can be done quickly
3. Task #5 verification after all implementation complete
4. Commit all F.1 changes as single commit
