# Planning Tracker â€” Active documents with checklists/exit criteria
# Jarvis MUST review this at session-end and milestone completion
# ENFORCEMENT: Documents marked 'mandatory' block completion until updated
#
# Version: 2.1.0 (Added session_plans, legacy_with_checklists)
# Last Updated: 2026-01-23
#
# LESSON LEARNED (2026-01-23):
# - Any document with `- [ ]` checkboxes is a tracking doc, regardless of status
# - "Superseded" docs may still have active checklists that need updating
# - Session plan files (.claude/plans/) should show completion status

version: 2.1.0
last_updated: 2026-01-23

# =============================================================================
# ENFORCEMENT LEVELS
# =============================================================================
# mandatory: MUST be updated before milestone/session can be marked complete
# required:  SHOULD be updated; warning if skipped but doesn't block
# advisory:  Optional; reminder only
# =============================================================================

# Documents to always review at session-end (MANDATORY)
always_review:
  - path: .claude/context/session-state.md
    purpose: Update current work status
    enforcement: mandatory
    verify_updated: check_modified_today

  - path: .claude/context/current-priorities.md
    purpose: Update task completion status
    enforcement: mandatory
    verify_updated: check_modified_today

# Session plan files (ephemeral - update on completion)
session_plans:
  - path: .claude/plans/*.md
    contains: [implementation-plan, exit-criteria]
    scope: all
    enforcement: advisory
    update_required_on: [plan-completion]
    action_on_completion: mark_status_complete
    note: "Plan files should show COMPLETE status when work is done"

# Project plans with checklists (should be archived when complete)
project_plans:
  - path: projects/project-aion/plans/current/*.md
    contains: [implementation-tasks, phase-checklists]
    scope: project-aion
    enforcement: advisory
    update_required_on: [plan-completion]
    action_on_completion: move_to_archive
    note: "Plans in current/ should be archived when fully implemented"

# Planning documents with checklists
planning:
  - path: projects/project-aion/roadmap.md
    contains: [pr-status, deliverables, acceptance-criteria]
    scope: project-aion
    enforcement: mandatory
    update_required_on: [pr-completion, milestone-completion]
    verify_command: "grep -c '\\[x\\]' {} || echo 0"  # Count checked items

  - path: projects/project-aion/designs/current/phase-6-autonomy-design.md
    contains: [sub-pr-checklists, acceptance-criteria]
    scope: phase-6
    enforcement: required
    update_required_on: [milestone-completion]

  - path: projects/project-aion/evolution/aifred-integration/roadmap.md
    contains: [session-exit-criteria, milestone-checklists]
    scope: aifred-integration
    enforcement: mandatory
    update_required_on: [session-end, milestone-completion]
    verify_command: "grep -c '\\- \\[x\\]' {} || echo 0"  # Count session checkboxes

# Legacy/superseded docs that still have active checklists
legacy_with_checklists:
  - path: projects/project-aion/evolution/aifred-integration/recommendations.md
    contains: [implementation-roadmap, decision-log]
    scope: aifred-integration
    enforcement: advisory
    update_required_on: [milestone-completion]
    note: "Marked superseded but still has tracking checkboxes - keep in sync"

# Progress documents (MANDATORY for milestone completion)
progress:
  - path: projects/project-aion/evolution/aifred-integration/chronicle.md
    contains: [milestone-narrative, decisions, learnings]
    scope: aifred-integration
    enforcement: mandatory
    update_required_on: [milestone-completion]
    verify_command: "grep -c '^## Milestone' {} || echo 0"  # Count milestone entries
    required_sections:
      - "What Was Done"
      - "How It Was Approached"
      - "Why Decisions Were Made"
      - "What Was Learned"
      - "What to Watch"

# =============================================================================
# MILESTONE COMPLETION GATE
# =============================================================================
# Before any milestone can be marked complete, ALL of the following must be true:
# 1. Relevant planning doc checkboxes updated
# 2. Chronicle entry written (if scope matches)
# 3. session-state.md reflects completion
# 4. AC-03 review passed OR explicitly skipped by user
#
# Reference: .claude/review-criteria/milestone-completion-gate.yaml
# =============================================================================

milestone_gate:
  enabled: true
  require_ac03_review: true
  allow_skip_with_reason: true

  # Documents that MUST be updated for milestone completion
  required_updates:
    - planning_doc_checkboxes
    - chronicle_entry
    - session_state

  # Scopes currently active (filter which docs apply)
  active_scopes:
    - project-aion
    - aifred-integration

# =============================================================================
# VERIFICATION PROTOCOL
# =============================================================================
# How Jarvis verifies documents are actually updated (not just touched)

verification:
  # Check file was modified today
  check_modified_today: "find {} -mtime 0 | grep -q ."

  # Check for unchecked items in scope
  check_pending_items: "grep -c '\\- \\[ \\]' {} || echo 0"

  # Check chronicle has entry for milestone N
  check_chronicle_entry: "grep -q 'Milestone {N}.*COMPLETE\\|Status.*Complete' {}"
