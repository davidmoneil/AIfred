# Autonomic Component Configuration
# Version: 1.0.0
# Created: 2026-01-16
# PR: PR-11.5, PR-12.1
#
# This file configures the behavior of all autonomic components.
# Components can be enabled/disabled and their behavior customized.
#
# Precedence (highest to lowest):
#   1. Emergency stop (JARVIS_EMERGENCY_STOP=true)
#   2. Environment variables (JARVIS_DISABLE_AC01=true)
#   3. This config file
#   4. Component defaults

version: "1.0"

# Global settings
global:
  # Master switch for all autonomy
  autonomy_enabled: true

  # Quick mode: minimal output, skip non-essential
  quick_mode: false

  # Manual mode: no autonomous initiation
  manual_mode: false

  # Logging level: debug, info, warn, error
  log_level: info

# Per-component configuration
components:
  # AC-01: Self-Launch Protocol
  AC-01-launch:
    enabled: true
    settings:
      # Include weather in greeting
      include_weather: true
      # Weather fetch timeout (ms)
      weather_timeout: 3000
      # Skip greeting entirely
      skip_greeting: false
      # Time-based greeting style
      greeting_style: formal  # formal, casual
      # Auto-continue with pending work
      auto_continue: true

  # AC-02: Wiggum Loop
  AC-02-wiggum:
    enabled: true
    settings:
      # Default to enabled (disable with "quick/rough/simple")
      default_active: true
      # Maximum verification passes
      max_passes: 15
      # Timeout per pass (ms)
      pass_timeout: 300000
      # Stop on first clean pass
      early_termination: false

  # AC-03: Milestone Review
  AC-03-review:
    enabled: true
    settings:
      # Auto-escalate to project-manager agent
      auto_escalate: true
      # Review depth: quick, standard, thorough
      default_depth: thorough
      # Generate report file
      generate_report: true

  # AC-04: Context Management (JICM v3)
  # Updated 2026-01-23: Statusline JSON API integration
  # - jarvis-watcher.sh now reads from .statusline-context.json (official API)
  # - Replaced fragile tmux pane scraping with official Claude Code data
  # - Pre-calculated used_percentage from statusline is authoritative
  # - Design: .claude/context/designs/jicm-architecture-solutions.md
  AC-04-jicm:
    enabled: true
    version: "3.0.0"
    settings:
      # Token threshold for compression trigger
      # Formula: 0.80 * (MAX_CONTEXT - OUTPUT_TOKENS) = 0.80 * (200000 - 20000) = 144000
      # jarvis-watcher.sh reads .statusline-context.json and triggers at this threshold
      threshold_tokens: 144000
      threshold_percentage: 80
      # Target compression ratio (legacy - see compression_target_percent)
      compression_target: 0.6
      # Auto-create checkpoint before compression
      auto_checkpoint: true
      # Trigger continuation after compression
      trigger_continuation: true

      # Context monitoring (v3.0.0)
      # Uses official Claude Code statusline JSON API
      monitoring:
        # File written by statusline-context-capture.sh
        statusline_context_file: .claude/context/.statusline-context.json
        # Poll interval (seconds) - statusline updates every 300ms on activity
        poll_interval: 30
        # Max age before context file considered stale (seconds)
        max_stale_seconds: 120
        # Context window size (Claude's max)
        context_window_size: 200000
        # Effective limit before performance degradation
        effective_limit: 180000

      # Threshold tiers for graduated response
      thresholds:
        healthy: 50     # Normal operation, no action
        caution: 60     # Log warning
        warning: 70     # Create soft checkpoint, continue
        critical: 80    # JICM trigger, intelligent compress
        emergency: 95   # Force immediate /clear

      # Intelligent Compression Settings (context-compressor agent)
      # Invoked via /intelligent-compress command
      compression:
        # Model for compression: haiku (fast/cheap), sonnet (balanced), opus (quality)
        # Using opus for highest quality context preservation and learning capture
        model: opus
        # Compression mode: aggressive (10%), default (15-20%), conservative (30%)
        mode: default
        # Specific target percentage (overrides mode if set)
        target_percent: 20
        # Write compressed context to this file
        output_file: .claude/context/.compressed-context.md
        # Inject compressed context post-clear via additionalContext
        auto_inject: true

      # JICM Autonomous Agent (Solution C)
      # Optional background agent for advanced context management
      autonomous_agent:
        # Enable autonomous JICM agent spawning
        enabled: false  # Set to true to activate Solution C
        # Agent definition file
        agent_file: .claude/agents/jicm-agent.md
        # Status file written by agent
        status_file: .claude/context/.jicm-status.json
        # Velocity tracking
        velocity:
          # Number of samples for velocity calculation
          sample_count: 10
          # Confidence threshold for predictions
          confidence_threshold: 0.8
        # Proactive management
        proactive:
          # Auto-disable Tier 2 MCPs at this threshold
          mcp_disable_threshold: 70
          # Begin checkpoint draft at this threshold
          checkpoint_draft_threshold: 75
          # Generate preservation manifest at this threshold
          manifest_threshold: 80

  # AC-05: Self-Reflection
  AC-05-reflect:
    enabled: true
    settings:
      # Minimum idle time before triggering (minutes)
      min_idle_minutes: 30
      # Maximum sessions to analyze
      max_sessions_analyzed: 10
      # Store patterns to Memory MCP
      use_memory_mcp: true

  # AC-06: Self-Evolution
  AC-06-evolve:
    enabled: true
    settings:
      # Always require approval for changes (cannot be disabled)
      require_approval: true
      # Maximum evolutions per session
      max_per_session: 5
      # Create git branch for changes
      use_branch: true
      # Run validation after changes
      validate_changes: true

  # AC-07: R&D Cycles
  AC-07-rnd:
    enabled: true
    settings:
      # External sources to query
      sources:
        - github
        - arxiv
        - web
      # Maximum discoveries per cycle
      max_discoveries: 10
      # All R&D proposals require approval
      require_approval: true

  # AC-08: Maintenance Workflows
  AC-08-maintain:
    enabled: true
    settings:
      # Scope: jarvis, project, both
      scope: both
      # Stale file threshold (days)
      stale_days: 30
      # Auto-fix organization issues
      auto_fix_org: false

  # AC-09: Session Completion
  AC-09-session:
    enabled: true
    settings:
      # Offer self-improvement before ending
      offer_self_improve: true
      # Preserve chat history
      preserve_history: true
      # Generate session summary
      generate_summary: true

# Safety settings
safety:
  # Cannot be disabled (hardcoded invariants)
  cannot_disable:
    - audit_logging
    - emergency_stop
    - critical_gates
    - baseline_readonly

  # Maximum time component can be disabled
  max_disable_duration:
    AC-02-wiggum: 24h
    AC-06-evolve: 168h  # 1 week

  # Warn after this duration
  warn_after:
    AC-02-wiggum: 4h
    AC-06-evolve: 24h

# Audit settings
audit:
  # Log all configuration changes
  log_changes: true
  # Retention period
  retention_days: 90
